##
## nginx
##
nginx:
  image: nginx:1.7
  volumes:
    - ./nginx.conf:/etc/nginx/nginx.conf:ro
  links:
    - server1:server1
    - server2:server2
  ports:
    - "8080:8080"         

##
## Server
##
server1:
  build: .
  links:
    - redismaster:redis
  ports:
    - "3001:3000"

server2:
  build: .
  links:
    - redismaster:redis
  ports:
    - "3002:3000"

##
## Redis
##
redismaster:
  image: redis
  command: redis-server /etc/redis.conf
  volumes:
    - ./redis-master.conf:/etc/redis.conf:ro
  ports:
    - "6379:6379"

redisslave:
  image: redis
  command: redis-server /etc/redis.conf
  volumes:
    - ./redis-slave.conf:/etc/redis.conf:ro
  links:
    - redismaster:master

